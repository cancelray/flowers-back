"use strict";const checkoutSubmit=async function(event){event.preventDefault();const notFilledInputs=1e3;let orderInfo=checkoutValid(1e3);if("number"==typeof orderInfo){if(1e3===orderInfo){const notFillError="Заполнтие все обязательные поля";return void showCheckoutPopup(notFillError)}{const validError="Проверьте правильность заполнения полей";return void showCheckoutPopup(validError)}}showChekoutLoader();const orderInfoJson=JSON.stringify(orderInfo),inputToken=document.querySelector('input[name="checkout-token"]');let token=inputToken.value,response;if((await fetch("/cartCheckout",{headers:{"X-CSRF-TOKEN":token},method:"POST",body:orderInfoJson})).ok){removeCheckoutLoader(),checkoutForm.reset();const success="Ваша заявка принята";showCheckoutPopup(success)}else{removeCheckoutLoader();const fail="Произошла ошибка сервера. Попробуйте ещё раз";showCheckoutPopup(fail)}},checkoutValid=notFilledInputs=>{let value={},errors=0,isError=!1;const requiredInputs=document.querySelectorAll("._required-input"),requiredInputsDelivery=document.querySelectorAll("._required-input-delivery"),mainCheckout=document.querySelectorAll("._main-checkout"),deliveryCheckout=document.querySelectorAll("._delivery-checkout"),radioLabels=document.querySelectorAll(".custom-radio"),deliveryCheck=document.querySelector('input[name="delivery-choose"]:checked'),paymentCheck=document.querySelector('input[name="payment-form"]:checked');if(deliveryCheck&&paymentCheck){radioLabels.forEach(e=>{e.classList.remove("text-error")});for(let i=0;i<requiredInputs.length;i++)if(errorRemove(requiredInputs[i]),!requiredInputs[i].value){for(let j=0;j<requiredInputs.length;j++)requiredInputs[j].value||requiredInputs[j].classList.add("error");isError=!0}}else radioLabels.forEach(e=>{e.classList.add("text-error")}),isError=!0;if(isError)return notFilledInputs;if(paymentCheck&&"courier-delivery"===deliveryCheck.value)for(let i=0;i<requiredInputsDelivery.length;i++)if(errorRemove(requiredInputsDelivery[i]),!requiredInputsDelivery[i].value){for(let j=0;j<requiredInputsDelivery.length;j++)requiredInputsDelivery[j].value||requiredInputsDelivery[j].classList.add("error");return notFilledInputs}for(let i=0;i<mainCheckout.length;i++){const input=mainCheckout[i];errorRemove(input),value.receiverName="",value.receiverPhone="","name"===input.attributes.name.value||"receiver-name"===input.attributes.name.value&&""!==input.value?input.value.length<3||!nameValid(input)?(errorAdd(input),errors++):"name"===input.attributes.name.value?value.name=input.value:value.receiverName=input.value:"phone"===input.attributes.name.value||"receiver-phone"===input.attributes.name.value&&""!==input.value?phoneValid(input)?"phone"===input.attributes.name.value?value.phone=input.value:value.receiverPhone=input.value:(errorAdd(input),errors++):"email"===input.attributes.name.value?emailValid(input)?value.email=input.value:(errorAdd(input),errors++):"comment"===input.attributes.name.value&&(value.comment=input.value)}return"self-carrier"===deliveryCheck.value?value.courierDelivery=!1:value.courierDelivery=!0,value.payment=paymentCheck.value,deliveryCheckout.forEach(input=>{switch(input.attributes.name.value){case"city":value.deliveryCity=input.value;break;case"street":value.deliveryStreet=input.value;break;case"building":value.deliveryBuilding=input.value;break;case"house":value.deliveryHouse=input.value;break;case"room":value.deliveryRoom=input.value;break;case"time":value.deliveryTime=input.value}}),errors>0?errors:value},errorAdd=input=>{input.classList.add("error")},errorRemove=input=>{input.classList.remove("error")},nameValid=input=>/^[a-zA-Zа-яА-Я'][a-zA-Zа-яА-Я-' ]+[a-zA-Zа-яА-Я']?$/.test(input.value),phoneValid=input=>/^(\+7|7|8)?[\s\-]?\(?[489][0-9]{2}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$/.test(input.value),emailValid=input=>/^[-._a-z0-9]+@(?:[a-z0-9][-a-z0-9]+\.)+[a-z]{2,6}$/.test(input.value),showChekoutLoader=()=>{loader.classList.remove("loader-hide"),checkoutContainer.classList.add("low-opacity")},removeCheckoutLoader=()=>{loader.classList.add("loader-hide"),checkoutContainer.classList.remove("low-opacity")},showCheckoutPopup=text=>{checkoutPopup.classList.add("show-checkout-popup");const checkoutPopupText=document.querySelector(".checkout-popup-txt");checkoutPopupText.innerText=text,checkoutContainer.classList.add("low-opacity")},closeCheckoutPopup=()=>{checkoutPopup.classList.remove("show-checkout-popup"),checkoutContainer.classList.remove("low-opacity")},checkoutForm=document.getElementById("checkout-form");checkoutForm.addEventListener("submit",checkoutSubmit);const loader=document.querySelector(".loader-checkout-form"),checkoutPopup=document.querySelector(".checkout-popup"),checkoutPopupWrapper=document.querySelector(".checkout-popup-wrapper"),checkoutPopupBtn=document.querySelector(".checkout-popup-btn"),checkoutContainer=document.getElementById("checkout-container");checkoutPopupBtn.addEventListener("click",closeCheckoutPopup),window.onclick=click=>{click.target!==checkoutPopupWrapper&&checkoutPopup.classList.contains("show-checkout-popup")&&closeCheckoutPopup()};